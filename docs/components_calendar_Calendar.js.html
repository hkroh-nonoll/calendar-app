

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>JSDoc: components/calendar/Calendar.js</title>

    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="./build/entry.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Muli:100,400,700|Oswald:300|Inconsolata,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
    <link type="text/css" rel="stylesheet" href="styles/app.min.css">
    <link type="text/css" rel="stylesheet" href="styles/iframe.css">
</head>

<body>
    <div id="stickyNavbarOverlay"></div>
    <div class="top-navbar">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                    
                    
                        <h1 class="navbar-item">Documentation</h1>
                    
                    <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                
            </nav>
        </div>
    </div>
    <div class="container">
        <div class="columns">
            <div class="column is-3" id="sidebarNav">
                <div class="sidebar">
                    <nav>
                        <h2><a href="index.html">Home</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="CalendarModel.html">CalendarModel</a></li><li><a href="EventModel.html">EventModel</a></li><li><a href="ExtsDate.html">ExtsDate</a></li><li><a href="Model.html">Model</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Calendar">Calendar</a></li><li><a href="global.html#CALENDAR">CALENDAR</a></li><li><a href="global.html#CALENDAR/VIEW_TYPE">CALENDAR/VIEW_TYPE</a></li><li><a href="global.html#DATE">DATE</a></li><li><a href="global.html#DATE/DAY_MILLISECONDS">DATE/DAY_MILLISECONDS</a></li><li><a href="global.html#DATE/DAY_NAME_WEEK">DATE/DAY_NAME_WEEK</a></li><li><a href="global.html#DATE/HOUR_MILLISECONDS">DATE/HOUR_MILLISECONDS</a></li><li><a href="global.html#DATE/MAX_DATES">DATE/MAX_DATES</a></li><li><a href="global.html#DATE/MINUTE_MILLISECONDS">DATE/MINUTE_MILLISECONDS</a></li><li><a href="global.html#DATE/START_DAY_WEEK">DATE/START_DAY_WEEK</a></li><li><a href="global.html#DATE/UNIT">DATE/UNIT</a></li><li><a href="global.html#DATE/WEEK_SIZE">DATE/WEEK_SIZE</a></li><li><a href="global.html#deepFreeze">deepFreeze</a></li><li><a href="global.html#ERROR_TYPES">ERROR_TYPES</a></li><li><a href="global.html#ERROR_TYPES/CALENDAR_INVALID_ADD_EVENT">ERROR_TYPES/CALENDAR_INVALID_ADD_EVENT</a></li><li><a href="global.html#ERROR_TYPES/CALENDAR_INVALID_MATCHED_EVENT">ERROR_TYPES/CALENDAR_INVALID_MATCHED_EVENT</a></li><li><a href="global.html#ERROR_TYPES/EVENT_INVALID_TIME_DIFF">ERROR_TYPES/EVENT_INVALID_TIME_DIFF</a></li><li><a href="global.html#ERROR_TYPES/MODEL_ABSTRACT_METHODS_MUST_BE_OVERRIDDEN">ERROR_TYPES/MODEL_ABSTRACT_METHODS_MUST_BE_OVERRIDDEN</a></li><li><a href="global.html#uuidv4">uuidv4</a></li></ul></div>
                    </nav>
                </div>
            </div>
            <div class="column is-9-desktop">
                <div class="content" id="main-content-wrapper">
                    <header class="page-title">
                        <p>Source</p>
                        <h1>components/calendar/Calendar.js</h1>
                    </header>
                    
                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import PropTypes from 'prop-types';
import React, { useState, useCallback, useEffect } from 'react';
import moment from 'moment';

import { VIEW_TYPE } from 'lib/constants/calendar';
import ExtsDate from 'lib/extensions/ExtsDate';

import { openNotificationSuccess, openNotificationWarning } from 'components/notification';
import ControlView from 'components/calendar/ControlView';
import MonthView from 'components/calendar/MonthView';
import WeekView from 'components/calendar/WeekView';
import EventModal from 'components/calendar/EventModal';

import CalendarModel from 'lib/models/Calendar/CalendarModel';
import EventModel from 'lib/models/Calendar/EventModel';

import { CALENDAR_INVALID_ADD_EVENT, EVENT_INVALID_TIME_DIFF } from 'lib/constants/errorTypes';

const View = props => {
  const { viewType } = props;

  switch(viewType) {
    case VIEW_TYPE.WEEK:
      return &lt;WeekView {...props} />;

    case VIEW_TYPE.MONTH:
    default:
      return &lt;MonthView {...props} />;
  }
}

const calendarModel = new CalendarModel();


/**
 * Component Calendar
 * @component
 * @see VIEW_TYPE
 * @see CalendarModel
 * @see EventModel
 * @example
 * import React, { useState, useCallback, useEffect } from 'react';
 * import Calendar from 'lib/models/Calendar/EventModel';
 * import EventModel from 'lib/models/Calendar/EventModel';
 * import { VIEW_TYPE } from 'lib/constants/calendar';
 * 
 * const SampleCalendar = () => {
 *  const defaultDate = new Date();
 *  const events = [{ title: '일정1', startAt: '2019-12-31T10:00:00+09:00', endAt: '2019-12-31T11:00:00+09:00' }];
 *  // const events = [new EventModel({ title: '일정2' })];
 *  
 *  return (
 *    &lt;Calendar defaultDate={defaultDate} defaultViewType={VIEW_TYPE.MONTH} events={events} />
 *  );
 * }
 */
const Calendar = props => {
  const { defaultDate, defaultViewType, events } = props;

  const [month, setMonth] = useState(defaultDate);
  const [week, setWeek] = useState(ExtsDate.startDateOfWeek({ date: defaultDate }));
  const [startDate, setStartDate] = useState(ExtsDate.startDateOfMonth({ date: month }));
  const [endDate, setEndDate] = useState(ExtsDate.endOfMonth({ date: month }));
  const [viewType, setViewType] = useState(defaultViewType);
  const [visibleModal, setVisibleModal] = useState(false);
  const [eventTitle, setEventTitle] = useState(null);
  const [eventStartAt, setEventStartAt] = useState(null);
  const [eventEndAt, setEventEndAt] = useState(null);
  const [eventEdit, setEventEdit] = useState(null);
  const [visibleDates, setVisibleDates] = useState(
    viewType === VIEW_TYPE.MONTH 
    ? ExtsDate.monthToArray({ date: month })
    : ExtsDate.weekToArray(week)
  );
  const [eventList, setEventList] = useState([]);

  const updateMonth = date => {
    const changeMonth = { date };
    setStartDate(ExtsDate.startDateOfMonth(changeMonth));
    setEndDate(ExtsDate.endOfMonth(changeMonth));
    setVisibleDates(ExtsDate.monthToArray(changeMonth));
    setMonth(date);
    setWeek(ExtsDate.startDateOfWeek(changeMonth));
  };

  const updateWeek = date => {
    const changeWeek = { date };
    setStartDate(ExtsDate.startDateOfMonth(changeWeek));
    setEndDate(ExtsDate.endOfMonth(changeWeek));
    setVisibleDates(ExtsDate.weekToArray(changeWeek));
    setMonth(date);
    setWeek(ExtsDate.startDateOfWeek(changeWeek));
  };

  const clearModal = _ => {
    setEventEdit(null);
    setVisibleModal(false);
  }

  const onCalendarPrevClick = useCallback(_ => {
    switch (viewType) {
      case VIEW_TYPE.WEEK:
        const prevWeek = ExtsDate.addWeek({ date: week, value: -1 });
        updateWeek(prevWeek);
        break;

      case VIEW_TYPE.MONTH:
      default:
        const prevMonth = ExtsDate.addMonth({ date: month, value: -1 });
        updateMonth(prevMonth);
        break;
    }
  }, [month, week, viewType]);

  const onCalendarTodayClick = useCallback(_ => {
    switch (viewType) {
      case VIEW_TYPE.WEEK:
        updateWeek(defaultDate);
        break;

      case VIEW_TYPE.MONTH:
      default:
        updateMonth(defaultDate);
        break;
    }
  }, [defaultDate, viewType]);

  const onCalendarNextClick = useCallback(_ => {
    switch (viewType) {
      case VIEW_TYPE.WEEK:
      default:
        const nextWeek = ExtsDate.addWeek({ date: week, value: 1 });
        console.log('nextWeek', nextWeek);
        updateWeek(nextWeek);
        break;

      case VIEW_TYPE.MONTH:
        const nextMonth = ExtsDate.addMonth({ date: month, value: 1 });
        updateMonth(nextMonth);
        break;
    }
  }, [month, week, viewType]);

  const onCalendarViewTypeChange = useCallback(value => {
    switch (value) {
      case VIEW_TYPE.WEEK:
        updateWeek(week);
        break;

      case VIEW_TYPE.MONTH:
      default:
        updateMonth(month);
        break;
    }
    setViewType(value);
  }, [month, week]);

  const onDateClick = useCallback(date => {
    const startAt = date;
    const endAt = ExtsDate.addHour({ date });

    setEventTitle('');
    setEventStartAt(startAt);
    setEventEndAt(endAt);
    setVisibleModal(true);
  }, []);

  const onEventClick = useCallback(({ date, event }) => {
    const { title, startAt, endAt } = event.toModel();

    setEventTitle(title);
    setEventStartAt(startAt);
    setEventEndAt(endAt);
    setEventEdit(event);
    setVisibleModal(true);
  }, []);

  const onModalConfirmClick = ({ form, title, startAt, endAt }) => {
    try {
      if (!eventEdit) {
        // 신규 생성시
        // TODO: moment 의존성 제거
        const newEvent = new EventModel({ title, startAt: moment(startAt).format(), endAt: moment(endAt).format() });
        calendarModel.addEvent(newEvent);
        setEventList(calendarModel.getEventList());
        openNotificationSuccess({ message: '일정이 추가되었습니다.' });
      } else {
        // 수정
        calendarModel.modifyEvent(Object.assign({}, eventEdit.toModel(), { title, startAt, endAt }));
        setEventList(calendarModel.getEventList());
        openNotificationSuccess({ message: '일정이 수정되었습니다.' });
      }
      clearModal();
    } catch (error) {
      // validate 에러 대응 처리
      switch (error.message) {
        case EVENT_INVALID_TIME_DIFF:
          openNotificationWarning({ message: '입력 값을 확인하세요', description: '종료일은 시작일 이후 일자로 선택하세요.' });
          break;

        case CALENDAR_INVALID_ADD_EVENT:
          openNotificationWarning({ message: '입력 값을 확인하세요.', description: '중복되는 일정이 있습니다.' });
          break;

        default:
          openNotificationWarning({ message: '입력 값을 확인하세요', description: '' });
          break;
      }
    }
  }

  const onModelDeleteClick = () => {
    calendarModel.deleteEvent(eventEdit);
    setEventList(calendarModel.getEventList());
    clearModal();
  }

  const onModalCancelClick = _ => clearModal();
  const onModalSubmit = _ => console.log('Calendar onModalSubmit');

  useEffect(() => {
    calendarModel.setEventList(CalendarModel.toEvents(events));
    setEventList(calendarModel.getEventList());
    return () => calendarModel &amp;&amp; calendarModel.destroy();
  }, [events]);

  useEffect(() => {
    return () => {
      clearModal();
    }
  }, []);

  return (
    &lt;div className="calendar">
      &lt;ControlView 
        currentMonth={ExtsDate.format({ date: month, format: 'YYYY년 MM월' })}
        currentWeek={
          `
          ${ExtsDate.format({
              date: ExtsDate.startDateOfWeek({ date: week }),
              format: 'YYYY년 MM월 DD일'
            })
          }
          ~
          ${ExtsDate.format({
              date: ExtsDate.endDateOfWeek({ date: week }),
              format: 'YYYY년 MM월 DD일'
            })
          }
          `
        }
        viewType={viewType}
        onPrevClick={onCalendarPrevClick}
        onTodayClick={onCalendarTodayClick}
        onNextClick={onCalendarNextClick}
        onViewTypeChange={onCalendarViewTypeChange}
      />

      &lt;View 
        currentMonth={month}
        currentWeek={week}
        viewType={viewType}
        startDate={startDate}
        endDate={endDate}
        week={week}
        dates={visibleDates}
        events={eventList}
        onDateClick={onDateClick}
        onEventClick={onEventClick}
      />

      {visibleModal &amp;&amp; 
        &lt;EventModal 
          visible={visibleModal}
          title={eventTitle}
          startAt={eventStartAt}
          endAt={eventEndAt}
          eventEdit={eventEdit}
          onConfirmClick={onModalConfirmClick}
          onCancelClick={onModalCancelClick}
          onDeleteClick={onModelDeleteClick}
          onSubmit={onModalSubmit}
        />
      }
    &lt;/div>
  );
}

const dummyEvents = (() => {
  const date = new Date('2020-01-01T00:00:00');
  return Array(2).fill(1).map((_, value) => {
    return {
      title: `일정 - ${value}`,
      startAt: ExtsDate.addHour({ date, value: value }),
      endAt: ExtsDate.addHour({ date, value: value + 1 })
    }
  });
})();

Calendar.defaultProps = {
  /**
   * 기본 일자 설정
   */
  defaultDate: PropTypes.instanceOf(Date),
  /**
   * 기본 화면 설정( 월 / 주 )
   */
  defaultViewType: PropTypes.arrayOf([
    VIEW_TYPE.MONTH,
    VIEW_TYPE.WEEK
  ]),
  /**
   * event 설정
   */
  events: PropTypes.array
};

Calendar.defaultProps = {
  defaultDate: new Date(),
  defaultViewType: VIEW_TYPE.MONTH,
  events: dummyEvents
};

export default Calendar;
</code></pre>
        </article>
    </section>




                </div>
            </div>
        </div>
    </div>


<footer class="footer">
    <div class="content has-text-centered">
        <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Thu Jan 02 2020 23:48:59 GMT+0900 (GMT+09:00)</p>
        <p class="sidebar-created-by">
            <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
            <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
        </p>
    </div>
</footer>


<script src="scripts/app.min.js"></script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
