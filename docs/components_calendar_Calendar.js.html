

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>JSDoc: components/calendar/Calendar.js</title>

    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="./build/entry.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Muli:100,400,700|Oswald:300|Inconsolata,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
    <link type="text/css" rel="stylesheet" href="styles/app.min.css">
    <link type="text/css" rel="stylesheet" href="styles/iframe.css">
</head>

<body>
    <div id="stickyNavbarOverlay"></div>
    <div class="top-navbar">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                    
                    
                        <h1 class="navbar-item">Documentation</h1>
                    
                    <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                
            </nav>
        </div>
    </div>
    <div class="container">
        <div class="columns">
            <div class="column is-3" id="sidebarNav">
                <div class="sidebar">
                    <nav>
                        <h2><a href="index.html">Home</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="CalendarModel.html">CalendarModel</a></li><li><a href="EventModel.html">EventModel</a></li><li><a href="ExtsDate.html">ExtsDate</a></li><li><a href="Model.html">Model</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Calendar">Calendar</a></li><li><a href="global.html#DATE">DATE</a></li><li><a href="global.html#DATE/DAY_MILLISECONDS">DATE/DAY_MILLISECONDS</a></li><li><a href="global.html#DATE/DAY_NAME_WEEK">DATE/DAY_NAME_WEEK</a></li><li><a href="global.html#DATE/HOUR_MILLISECONDS">DATE/HOUR_MILLISECONDS</a></li><li><a href="global.html#DATE/MAX_DATES">DATE/MAX_DATES</a></li><li><a href="global.html#DATE/START_DAY_WEEK">DATE/START_DAY_WEEK</a></li><li><a href="global.html#DATE/UNIT">DATE/UNIT</a></li><li><a href="global.html#DATE/WEEK_SIZE">DATE/WEEK_SIZE</a></li><li><a href="global.html#deepFreeze">deepFreeze</a></li><li><a href="global.html#ERROR_TYPES">ERROR_TYPES</a></li><li><a href="global.html#ERROR_TYPES/CALENDAR_INVALID_ADD_EVENT">ERROR_TYPES/CALENDAR_INVALID_ADD_EVENT</a></li><li><a href="global.html#ERROR_TYPES/CALENDAR_INVALID_MATCHED_EVENT">ERROR_TYPES/CALENDAR_INVALID_MATCHED_EVENT</a></li><li><a href="global.html#ERROR_TYPES/EVENT_INVALID_TIME_DIFF">ERROR_TYPES/EVENT_INVALID_TIME_DIFF</a></li><li><a href="global.html#uuidv4">uuidv4</a></li></ul></div>
                    </nav>
                </div>
            </div>
            <div class="column is-9-desktop">
                <div class="content" id="main-content-wrapper">
                    <header class="page-title">
                        <p>Source</p>
                        <h1>components/calendar/Calendar.js</h1>
                    </header>
                    
                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useCallback, useEffect } from 'react';
import { notification } from 'antd';
import moment from 'moment';

import ExtsDate from 'lib/extensions/ExtsDate';

import ControlView from 'components/calendar/ControlView';
import MonthView from 'components/calendar/MonthView';
import WeekView from 'components/calendar/WeekView';
import EventModal from 'components/calendar/EventModal';

import CalendarModel from 'lib/models/Calendar/CalendarModel';
import EventModel from 'lib/models/Calendar/EventModel';

import { CALENDAR_INVALID_ADD_EVENT, EVENT_INVALID_TIME_DIFF } from 'lib/constants/errorTypes';

const openNotificationWithIcon = ({ message = '', description = '' }) => {
  notification['warning']({ message, description });
}

const View = props => {
  const { viewType } = props;

  switch(viewType) {
    case 'week':
      return &lt;WeekView {...props} />;
    case 'month':
    default:
      return &lt;MonthView {...props} />;
  }
}

const calendarModel = new CalendarModel();


/**
 * Component Calendar
 * @component
 * @example
 * import Calendar from 'lib/models/Calendar/EventModel';
 * import EventModel from 'lib/models/Calendar/EventModel';
 * const defaultDate = new Date();
 * const events = [{ title: '일정1', startAt: '2019-12-31T10:00:00+09:00', endAt: '2019-12-31T11:00:00+09:00' }];
 * // const events = [new EventModel({ title: '일정2' })];
 * 
 * ...
 * return (
 *   &lt;Calendar defaultDate={defaultDate} events={events} />
 * );
 * ...
 */
const Calendar = props => {
  const { defaultDate, events } = props;

  const [month, setMonth] = useState(defaultDate);
  const [week] = useState(defaultDate);
  const [startDate, setStartDate] = useState(ExtsDate.startDateOfMonth({ date: month }));
  const [endDate, setEndDate] = useState(ExtsDate.endOfMonth({ date: month }));
  const [viewType, setViewType] = useState('month');
  const [visibleModal, setVisibleModal] = useState(false);
  const [eventTitle, setEventTitle] = useState(null);
  const [eventStartAt, setEventStartAt] = useState(null);
  const [eventEndAt, setEventEndAt] = useState(null);
  const [eventEdit, setEventEdit] = useState(null);
  const [visibleDates, setVisibleDates] = useState(ExtsDate.monthToArray({ date: month }));
  const [eventList, setEventList] = useState([]);

  const updateMonth = month => {
    setStartDate(ExtsDate.startDateOfMonth({ date: month }));
    setEndDate(ExtsDate.endOfMonth({ date: month }));
    setVisibleDates(ExtsDate.monthToArray({ date: month }));
    setMonth(month);
  }

  const clearModal = () => {
    setEventEdit(null);
    setVisibleModal(false);
  }

  const onPrevMonthClick = useCallback(_ => {
    console.log('Calendar onPrevMonthClick');
    const prevMonth = ExtsDate.addMonth({ date: month, value: -1 });
    updateMonth(prevMonth);
  }, [month]);

  const onTodayClick = useCallback(_ => {
    console.log('Calendar onTodayClick');
    updateMonth(defaultDate);
  }, [defaultDate]);

  const onNextMonthClick = useCallback(_ => {
    console.log('Calendar onNextMonthClick');
    const nextMonth = ExtsDate.addMonth({ date: month, value: 1 });
    updateMonth(nextMonth);
  }, [month]);

  const onViewTypeChange = useCallback(value => {
    console.log('Calendar onViewTypeChange', value);
    setViewType(value);
  }, []);

  const onDateClick = useCallback(date => {
    console.log('Calendar onDateClick');
    // const selectedDate = moment(`${moment(month).format('YYYY-MM')}-${date}`).format();
    // console.log('selectedDate', selectedDate, month, date);
    
    const startAt = date;
    const endAt = ExtsDate.addHour({ date });

    setEventTitle('');
    setEventStartAt(startAt);
    setEventEndAt(endAt);
    setVisibleModal(true);
  }, [month]);

  const onEventClick = useCallback(({ date, event }) => {
    const { title, startAt, endAt } = event.toModel();
    console.log('Calendar onEventClick', date, title, startAt, endAt);
    // const selectedDate = moment(`${moment(month).format('YYYY-MM')}-${date}`);
    setEventTitle(title);
    setEventStartAt(startAt);
    setEventEndAt(endAt);
    setEventEdit(event);
    setVisibleModal(true);
  }, [month]);

  const onModalConfirmClick = ({ form, title, startAt, endAt }) => {
    console.log('Calendar onModalConfirmClick', form, title, startAt, endAt);

    try {
      if (!eventEdit) {
        // 신규 생성시
        // TODO: moment 의존성 제거
        const newEvent = new EventModel({ title, startAt: moment(startAt).format(), endAt: moment(endAt).format() });
        calendarModel.addEvent(newEvent);
        setEventList(calendarModel.getEventList());
      } else {
        // 수정
        calendarModel.modifyEvent(Object.assign({}, eventEdit.toModel(), { title, startAt, endAt }));
        setEventList(calendarModel.getEventList());
      }
      clearModal();
    } catch (error) {
      // validate 에러 대응 처리
      switch (error.message) {
        case EVENT_INVALID_TIME_DIFF:
          openNotificationWithIcon({ message: '입력 값을 확인하세요', description: '종료일은 시작일 이후 일자로 선택하세요.' });
          break;

        case CALENDAR_INVALID_ADD_EVENT:
          openNotificationWithIcon({ message: '입력 값을 확인하세요.', description: '중복되는 일정이 있습니다.' });
          break;

        default:
          openNotificationWithIcon({ message: '입력 값을 확인하세요', description: '' });
          break;
      }
    }
  }

  const onModelDeleteClick = () => {
    calendarModel.deleteEvent(eventEdit);
    setEventList(calendarModel.getEventList());
    console.log('Calendar onModelDeleteClick', calendarModel.getEventList());
    clearModal();
  }

  const onModalCancelClick = () => {
    console.log('Calendar onCancelClick');
    clearModal();
  }

  const onModalSubmit = () => {
    console.log('Calendar onModalSubmit');
  }

  // TODO: memo 처리 가능할지, Model 연결 테스트 진행
  useEffect(() => {
    calendarModel.setEventList(CalendarModel.toEvents(events));
    setEventList(calendarModel.getEventList());
    return () => calendarModel &amp;&amp; calendarModel.destroy();
  }, [events]);

  useEffect(() => {
    return () => {
      clearModal();
    }
  }, []);

  console.log('eventList', eventList);

  return (
    &lt;div className="calendar">
      &lt;ControlView 
        currentMonth={ExtsDate.format({ date: month, format: 'YYYY년 MM월' })}
        onPrevMonthClick={onPrevMonthClick}
        onTodayClick={onTodayClick}
        onNextMonthClick={onNextMonthClick}
        onViewTypeChange={onViewTypeChange}
      />

      &lt;View 
        currentMonth={month}
        currentWeek={week}
        viewType={viewType}
        startDate={startDate}
        endDate={endDate}
        dates={visibleDates}
        events={eventList}
        onDateClick={onDateClick}
        onEventClick={onEventClick}
      />
      
      {/* 임시 - 재갱신 처리 */}
      {visibleModal &amp;&amp; 
        &lt;EventModal 
          visible={visibleModal}
          title={eventTitle}
          startAt={eventStartAt}
          endAt={eventEndAt}
          eventEdit={eventEdit}
          onConfirmClick={onModalConfirmClick}
          onCancelClick={onModalCancelClick}
          onDeleteClick={onModelDeleteClick}
          onSubmit={onModalSubmit}
        />
      }
    &lt;/div>
  );
}

Calendar.defaultProps = {
  defaultDate: new Date(),
  events: [
    {
      title: '12월 31일 10 ~ 11시 일정',
      startAt: '2019-12-31T10:00:00+09:00',
      endAt: '2019-12-31T11:00:00+09:00'
    }
  ]
};

export default Calendar;
</code></pre>
        </article>
    </section>




                </div>
            </div>
        </div>
    </div>


<footer class="footer">
    <div class="content has-text-centered">
        <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Thu Jan 02 2020 00:15:45 GMT+0900 (GMT+09:00)</p>
        <p class="sidebar-created-by">
            <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
            <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
        </p>
    </div>
</footer>


<script src="scripts/app.min.js"></script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
